# ğŸš€ å±‹é¡¶æ£€æµ‹ä¸å¤ªé˜³èƒ½æ¿è®¡ç®—ç³»ç»Ÿé›†æˆéƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é›†æˆç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  å±‹é¡¶æ£€æµ‹ç³»ç»Ÿ    â”‚    â”‚ å¤ªé˜³èƒ½æ¿è®¡ç®—ç³»ç»Ÿ â”‚                â”‚
â”‚  â”‚   (Port 8000)   â”‚â—„â”€â”€â–ºâ”‚   (Port 8001)   â”‚                â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ YOLOåˆ†å‰²      â”‚    â”‚ â€¢ é¢æ¿å¸ƒå±€è®¡ç®—   â”‚                â”‚
â”‚  â”‚ â€¢ Base64è¾“å‡º    â”‚    â”‚ â€¢ å¯è§†åŒ–ç”Ÿæˆ     â”‚                â”‚
â”‚  â”‚ â€¢ FastAPI       â”‚    â”‚ â€¢ Flask API     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                       â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                       â”‚                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚   ç»Ÿä¸€å®¢æˆ·ç«¯     â”‚                           â”‚
â”‚              â”‚ roof_detection_ â”‚                           â”‚
â”‚              â”‚    client.py    â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ éƒ¨ç½²æ–¹å¼

### æ–¹å¼1: Docker Compose (æ¨è)

#### 1. å‡†å¤‡å·¥ä½œ
```bash
# ç¡®ä¿å¯¹æ–¹çš„ä»£ç åœ¨æ­£ç¡®ä½ç½®
ls roof_detect_segument/roof/
# åº”è¯¥çœ‹åˆ°: app/, models/, Dockerfile, requirements.txt

# ç¡®ä¿æˆ‘ä»¬çš„ä»£ç æ–‡ä»¶å­˜åœ¨
ls *.py
# åº”è¯¥çœ‹åˆ°: api_integration.py, roof_detection_client.py, ç­‰
```

#### 2. æ„å»ºå’Œå¯åŠ¨
```bash
# å¯åŠ¨å±‹é¡¶æ£€æµ‹å’Œå¤ªé˜³èƒ½æ¿è®¡ç®—ç³»ç»Ÿ
docker-compose -f docker-compose.integration.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.integration.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.integration.yml logs -f
```

#### 3. éªŒè¯éƒ¨ç½²
```bash
# æ£€æŸ¥å±‹é¡¶æ£€æµ‹ç³»ç»Ÿ
curl http://localhost:8000/docs

# æ£€æŸ¥å¤ªé˜³èƒ½æ¿è®¡ç®—ç³»ç»Ÿ
curl http://localhost:8001/health
```

#### 4. ä½¿ç”¨ç»Ÿä¸€å®¢æˆ·ç«¯
```bash
# å¯åŠ¨å®¢æˆ·ç«¯å®¹å™¨
docker-compose -f docker-compose.integration.yml --profile client up integration-client
```

### æ–¹å¼2: æœ¬åœ°å¼€å‘ç¯å¢ƒ

#### 1. å®‰è£…ä¾èµ–
```bash
# å®‰è£…æˆ‘ä»¬ç³»ç»Ÿçš„ä¾èµ–
pip install -r requirements.txt

# å®‰è£…å¯¹æ–¹ç³»ç»Ÿçš„ä¾èµ–
cd roof_detect_segument/roof
pip install -r requirements.txt
cd ../..
```

#### 2. å¯åŠ¨å±‹é¡¶æ£€æµ‹ç³»ç»Ÿ
```bash
# åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯
cd roof_detect_segument/roof
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

#### 3. å¯åŠ¨å¤ªé˜³èƒ½æ¿è®¡ç®—ç³»ç»Ÿ
```bash
# åœ¨ç¬¬äºŒä¸ªç»ˆç«¯
python api_integration.py
# æˆ–è€…
python start_integration.py
```

#### 4. è¿è¡Œæµ‹è¯•
```bash
# åœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯
python test_integration.py
```

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### 1. åŸºæœ¬åŠŸèƒ½æµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python test_integration.py

# é€‰æ‹©æµ‹è¯•é¡¹ç›®:
# 1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
# 2. åŸºæœ¬APIçµ±åˆãƒ†ã‚¹ãƒˆ  
# 3. å±‹æ ¹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå‡¦ç†ãƒ†ã‚¹ãƒˆ
# 4. ã‚µãƒ³ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
# 5. çµ±åˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
```

### 2. ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
```bash
# ä½¿ç”¨ç»Ÿä¸€å®¢æˆ·ç«¯
python roof_detection_client.py

# é€‰æ‹© "1. å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ"
# æä¾›æµ‹è¯•å›¾åƒå’Œåæ ‡
```

### 3. APIç›´æ¥æµ‹è¯•
```bash
# æµ‹è¯•å±‹é¡¶æ£€æµ‹ (éœ€è¦å›¾åƒæ–‡ä»¶)
curl -X POST http://localhost:8000/segment_click \
  -F "x=250" \
  -F "y=200" \
  -F "image=@test_image.jpg"

# æµ‹è¯•å¤ªé˜³èƒ½æ¿è®¡ç®—
curl -X POST http://localhost:8001/process_roof_segments \
  -H "Content-Type: application/json" \
  -d @sample_request.json
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. æœåŠ¡å¥åº·æ£€æŸ¥
```bash
# å±‹é¡¶æ£€æµ‹ç³»ç»Ÿ
curl http://localhost:8000/docs

# å¤ªé˜³èƒ½æ¿è®¡ç®—ç³»ç»Ÿ  
curl http://localhost:8001/health
```

### 2. æ—¥å¿—æŸ¥çœ‹
```bash
# Dockerç¯å¢ƒ
docker-compose -f docker-compose.integration.yml logs roof-detection
docker-compose -f docker-compose.integration.yml logs solar-panel-calc

# æœ¬åœ°ç¯å¢ƒ
# æŸ¥çœ‹å„æœåŠ¡çš„æ§åˆ¶å°è¾“å‡º
```

### 3. æ€§èƒ½ç›‘æ§
```bash
# å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats

# ç³»ç»Ÿèµ„æºç›‘æ§
htop
```

## ğŸ”§ é…ç½®å‚æ•°

### ç¯å¢ƒå˜é‡
```bash
# å¤ªé˜³èƒ½æ¿è®¡ç®—ç³»ç»Ÿ
FLASK_RUN_PORT=8001          # APIç«¯å£
LOG_LEVEL=INFO               # æ—¥å¿—çº§åˆ«

# ç»Ÿä¸€å®¢æˆ·ç«¯
ROOF_API_URL=http://localhost:8000      # å±‹é¡¶æ£€æµ‹API
PANEL_API_URL=http://localhost:8001     # å¤ªé˜³èƒ½æ¿è®¡ç®—API
```

### è®¡ç®—å‚æ•°
```json
{
  "center_latitude": 35.6895,    // ä¸­å¿ƒçº¬åº¦
  "map_scale": 0.05,             // åœ°å›¾æ¯”ä¾‹ (m/pixel)
  "spacing_interval": 0.3        // é¢æ¿é—´è· (meters)
}
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8000
netstat -tulpn | grep :8001

# ä¿®æ”¹ç«¯å£é…ç½®
export FLASK_RUN_PORT=8002
```

#### 2. ä¾èµ–é—®é¢˜
```bash
# é‡æ–°å®‰è£…ä¾èµ–
pip install --upgrade -r requirements.txt

# æ£€æŸ¥OpenCVå®‰è£…
python -c "import cv2; print(cv2.__version__)"
```

#### 3. å†…å­˜ä¸è¶³
```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
free -h

# è°ƒæ•´Dockerå†…å­˜é™åˆ¶
docker-compose -f docker-compose.integration.yml up -d --memory=2g
```

#### 4. æ¨¡å‹æ–‡ä»¶ç¼ºå¤±
```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls roof_detect_segument/roof/models/
# åº”è¯¥åŒ…å«: best_v2.pt, roof_yolov8m-seg.pt, yolo_multi_detect.pt
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose -f docker-compose.integration.yml logs | grep ERROR

# æŸ¥çœ‹APIè°ƒç”¨æ—¥å¿—
docker-compose -f docker-compose.integration.yml logs | grep "POST"
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. ç³»ç»Ÿä¼˜åŒ–
- ä½¿ç”¨GPUåŠ é€Ÿ (å¦‚æœå¯ç”¨)
- è°ƒæ•´å›¾åƒå¤„ç†åˆ†è¾¨ç‡
- ä¼˜åŒ–å†…å­˜ä½¿ç”¨

### 2. APIä¼˜åŒ–
- å¯ç”¨è¯·æ±‚ç¼“å­˜
- ä½¿ç”¨è¿æ¥æ± 
- å¼‚æ­¥å¤„ç†é•¿æ—¶é—´ä»»åŠ¡

### 3. éƒ¨ç½²ä¼˜åŒ–
- ä½¿ç”¨ç”Ÿäº§çº§WSGIæœåŠ¡å™¨ (Gunicorn)
- é…ç½®è´Ÿè½½å‡è¡¡
- å¯ç”¨APIç½‘å…³

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. APIå®‰å…¨
- æ·»åŠ è®¤è¯æœºåˆ¶
- é™åˆ¶è¯·æ±‚é¢‘ç‡
- éªŒè¯è¾“å…¥æ•°æ®

### 2. ç½‘ç»œå®‰å…¨
- ä½¿ç”¨HTTPS
- é…ç½®é˜²ç«å¢™
- é™åˆ¶ç½‘ç»œè®¿é—®

### 3. æ•°æ®å®‰å…¨
- åŠ å¯†æ•æ„Ÿæ•°æ®
- å®šæœŸå¤‡ä»½
- è®¿é—®æ—¥å¿—è®°å½•

## ğŸ“ æ”¯æŒå’Œç»´æŠ¤

### è”ç³»ä¿¡æ¯
- æŠ€æœ¯æ”¯æŒ: å¼€å‘å›¢é˜Ÿ
- æ–‡æ¡£æ›´æ–°: å®šæœŸç»´æŠ¤
- é—®é¢˜æŠ¥å‘Š: GitHub Issues

### ç»´æŠ¤è®¡åˆ’
- å®šæœŸæ›´æ–°ä¾èµ–
- æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- å®‰å…¨è¡¥ä¸åº”ç”¨

---

**æœ€åæ›´æ–°**: 2025-06-27  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…
